사과승준과 이키노피오
=================

* 배포 URL : <배포 준비는 완료되었으나 서버 관리 문제로 현재는 운영하고 있지 않습니다.>
* Test ID : GUEST는 패스워드가 필요 없습니다.
* ADMIN PW : 3919
- - -

## 프로젝트 소개
* ‘사과승준과 이키노피오’ 사이트는 저희 커플이 데이트 기록을 하기 위한 공간입니다.
* 기존에 사용하던 커플 앱인 ‘더 커플’을 기반으로 작업하였습니다.
* 핵심 기능은 스토리 작성과 장소를 저장하는 지도 기능입니다.
- - -   

## 팀 구성
* 배승준 : 백엔드, 프론트엔드, DB 개발, 서버 배포
* 이수연 : 디자인

## 1. 개발 환경

* FrontEnd : React   
* BackEnd : Spring Boot, Spring Security   
* DataBase : MySQL, AWS RDS   
* 서비스 배포 : AWS EC2

- - -

## 2. 개발 기간

* 전체 기능 개발 기간 : 2024-01-12 ~ 2024-03-17
* 디자인 개발 기간 : 2024-03-18 ~ 2024-04-04

- - -

## 3. 페이지별 기능


### [로그인]

처음 사이트 접속 시 로그인 화면이 나타납니다. 사용자 선택 창은 넷플릭스, 왓챠 등 OTT 서비스에서 흔히 볼 수 있는 친근한 화면으로 구성하였습니다.   
[사용자 선택] > [패스워드 입력] > [로그인 완료]   
*Guest 계정은 로그인 과정 없이 접속 가능합니다.   

![Login](https://github.com/bsj039190/AppleJun/assets/81723581/6c04ee86-fec9-49bb-84c4-090853476893)


### [홈화면]

배경 화면은 설정된 사진 중 랜덤으로 선택됩니다. 홈 화면에서 모든 서비스로 접속 가능합니다.   
*Guest 계정은 ADMIN의 배경 화면이 보입니다.   

![Home](https://github.com/bsj039190/AppleJun/assets/81723581/8287e3b0-c2f0-461c-9574-16cf909178d4)


### [프로필 수정]
프로필 사진을 클릭하여 개인 프로필을 수정할 수 있습니다.   

![ProfileUpdate](https://github.com/bsj039190/AppleJun/assets/81723581/9f1d1ffd-f402-4fc6-a42e-3f489578ddf9)


### [헤더]

현재 위치한 페이지를 알려줍니다. 프로필 중앙의 하트 아이콘 클릭 시 홈 화면으로 바로 이동 가능합니다.   

![Header](https://github.com/bsj039190/AppleJun/assets/81723581/0b2726ee-2a48-4f9d-8019-16dd0c664802)



### [스토리 목록]

그동안 기록한 모든 스토리를 확인할 수 있습니다.   
스토리 클릭 시 자세한 내용을 볼 수 있습니다.   
하단의 ‘더 보기’ 버튼을 클릭하여 이전 화면으로 돌아올 수 있습니다.   

![StoryList](https://github.com/bsj039190/AppleJun/assets/81723581/1e54fddd-efa3-4dbe-a8eb-b2e42320d48c)


### [상세 스토리]

스토리 목록에서 클릭한 상세한 내용이 보이는 페이지입니다.   
지도 아이콘 클릭 시 해당 장소의 URL로 자동 이동됩니다.   
[수정하기] 버튼 클릭 시 작성된 스토리를 수정할 수 있습니다.   

![Story](https://github.com/bsj039190/AppleJun/assets/81723581/87558fb4-452b-42f4-827d-190ce7dcfc2c)



### [스토리 작성]
* * *
1. 데이트 중 기록하고 싶었던 내용을 작성합니다.   

![StoryWrite1](https://github.com/bsj039190/AppleJun/assets/81723581/2a1ca338-6d72-4cdb-89b5-6153a921b399)



* * *
2. 함께 갔던 곳을 기록합니다. 최대 3개까지 지정할 수 있습니다.   

![StoryWrite2](https://github.com/bsj039190/AppleJun/assets/81723581/82f62a03-4a66-4b24-b28f-3fd8871b983d)



* * *
3. 추억으로 남길 사진을 업로드합니다. 최대 3장까지 업로드 할 수 있습니다.
   ‘저장하기’ 버튼 클릭 시 자동 업로드됩니다.   

![StoryWrite3](https://github.com/bsj039190/AppleJun/assets/81723581/11c12bc2-0fdf-4fb3-804c-522c1657f06a)



* * *
4. Guest 계정은 업로드가 불가합니다.   

![StoryWriteGuest](https://github.com/bsj039190/AppleJun/assets/81723581/007bb0d8-0369-4c0e-8201-f6a00d5f7cbb)




### [지도]

연인과 함께 다녔던 장소들을 표시하고 기록할 수 있습니다. 기존에 사용하던 네이버 지도 API를 삽입하여 편리하게 이용할 수 있습니다.   
저장된 마커 마우스 오버 시 대략적인 위치를 Info Window로 확인 가능합니다.   
마커 클릭 시 하단의 장소에 대한 상세 정보가 로드됩니다.   

![Map1](https://github.com/bsj039190/AppleJun/assets/81723581/5ece25ae-1a80-4c86-9b61-5814a4544c53)

* * *
1. [URL 이동] 버튼을 클릭하여 해당하는 위치의 URL을 새창으로 이동합니다.

![Map2](https://github.com/bsj039190/AppleJun/assets/81723581/c78d6997-1000-4ac0-ac10-7bcdfd2568c3)

* * *
2. [수정] 버튼을 클릭하여 장소의 카테고리, 방문한 날짜, 위치 등을 수정할 수 있습니다.

![Map3](https://github.com/bsj039190/AppleJun/assets/81723581/7d0a9ac6-db93-46c1-99f5-bd3ef2dee794)

* * *
[삭제] 버튼을 클릭하여 해당 좌표를 제거할 수 있습니다.   


[리스트로 보기] 버튼을 클릭하여 한눈에 보기 편하게 정렬된 리스트 페이지로 이동할 수 있습니다.



### [지도리스트]

접근방법: [홈 화면] > [지도 아이콘] or [지도 리스트]   
[지도페이지] > [‘리스트로 보기’버튼]   
지도에 저장된 장소가 많아지게 되면 수정 및 삭제가 지도 화면에서 원활하지 않을 수 있기에 제작하였습니다. 대부분의 기능은 ‘지도’ 페이지와 동일합니다.   

![MapList](https://github.com/bsj039190/AppleJun/assets/81723581/373f8d71-ce06-4aef-b077-bbc02184493d)


### [새로운 장소]


* * *
1. [GPS변환] 버튼을 클릭하면 해당 주소의 위도, 경도 값이 입력됩니다.   

![MapCreate2](https://github.com/bsj039190/AppleJun/assets/81723581/d704067b-b93d-49cb-b5e8-05b74a950394)


* * *
2. [URL 수정] 버튼을 클릭하면 네이버 지도에서 이름으로 기록된 검색어가 자동으로 검색됩니다.

![MapCreate1](https://github.com/bsj039190/AppleJun/assets/81723581/c4f538c1-ae80-4e6b-a04a-89427c7d3030)



### [배경화면]

메인 홈에서 보이는 배경 화면을 추가 및 삭제할 수 있습니다.

[사진 추가하기] 버튼 클릭 시 새로운 배경화면을 추가합니다.

![Back1](https://github.com/bsj039190/AppleJun/assets/81723581/7fa1149f-755e-450b-9a86-cbc914cbb3c4)

* * *
![Back2](https://github.com/bsj039190/AppleJun/assets/81723581/da221be0-bb66-46a3-9667-35ec7172525e)



### **&lt;&lt;&lt; 새로운 기능이 계속해서 추가 될 예정입니다. &gt;&gt;&gt;**

- - -

## 4. 트러블 슈팅

**스토리 상세화면 사진 이슈**
> 포스트 상세화면에서 사진이 엑스박스로 뜨는 이슈가 있었다.   
> 원인은 사진의 저장 위치가 잘못되어 있었고 src 위치도 잘못되어있었다.   
> 프론트에서 위치의 시작점이 public 폴더라는 사실을 모르고 있었다...   
> 백엔드에서 저장위치와 프론트에서 로드하는 위치를 수정해서 이슈를 해결했다.

* __문제상황__ : 스토리 상세화면에서 사진이 엑스박스로 뜸.

  * __의도했던 기능__ : 스토리 상세화면에서 사진이 정상적으로 보여야 함.
 
  * __트러블 원인__   
    사진의 저장 위치 및 src 시작 위치 또한 잘못되어 있었음.
   
  * __해결방법__   
    백엔드에서 저장위치와 프론트엔드에서 로드하는 위치를 수정함.  


**지도 InfoWindow 이슈**
> 지도에서 마우스 오버 이벤트로 InfoWindow를 띄우려고 했으나 animation 오류가 떴다.   
> 공식문서까지 봐가면서 시도해보았지만 &lt;NaverMap&gt; 함수 안에서는 끝까지 InfoWindow가 뜨지 않았다.   
> 결국 기존의 코드를 버리고 id = "map" 방식으로 바꿔서 했다.   
> 바꾼 방식으로 하니 잘된다.

* __문제상황__ : 지도에서 mouseOver 이벤트에서 animation 오류가 뜸.

  * __의도했던 기능__ : mouseOver시 InfoWindow가 띄워져야 함.
 
  * __트러블 원인__   
    &lt;NaverMap&gt; 함수를 사용할 시에는 InfoWindow를 지원하지 않는다고 추론함.
   
  * __트러블 해소과정 1__
    함수 내의 animation 값을 null 또는 1로 변경하였지만 여전히 같은 오류가 뜸.

  * __트러블 해소과정 2__
    공식문서까지 봐가면서 시도 해 보았지만 &lt;NaverMap&gt; 함수 안에서는 끝까지 InfoWindow가 뜨지 않음

  * __해결방법__
    기존의 코드를 버리고 id = "map" 방식으로 코드를 재작성함.


**지도 Modal 창 이슈**
> 원래 지도에서 마커를 클릭하면 상세정보와 수정, 삭제가 가능하도록 하려고 했는데 모달창이 뜨면 계속 오류가 나서 못하고 있었다.   
> 그래서 수정, 삭제 부분은 리스트로 넘겨버렸는데 방금 위에 InfoWindow 이슈를 쓰면서 '바뀐 코드에서는 가능하지 않을까..?' 하고 시도해봤더니 작동이 가능해졌다.   
> 그래서 지금 바꾼다ㅋㅋㅋㅋㅋㅋㅋ

 * __문제상황__ : 지도에서 marker를 클릭하면 상세정보, 수정, 삭제가 되어야 하는데 modal창이 뜨면 오류가 나는 문제
   
  * __의도했던 기능__ : 지도에서 marker를 클릭하면 각 버튼에 맞는 기능의 modal창이 나타나야함.
 
  * __트러블 원인__   
    위의 *지도 InfoWindow 이슈* 처럼 &lt;NaverMap&gt; 함수 안에서는 작동하지 않는다고 추론함.
   
  * __트러블 해소과정 1__
    marker를 클릭하는 것이 아닌 새로운 버튼을 만들어서 modal창을 띄우도록 만듬.

  * __해결방법__
    *지도 InfoWindow 이슈* 를 작성하며 새로 작성된 코드에 적용해서 시도하니 정상적으로 작동이 됨.

**로그인 이슈**
> 프론트에서 로그인이 안되는 이슈가 발생했다.   
> 그래서 3000번 포트가 아니라 8080포트로 가서 로그인을 해보니 잘 되는것을 확인했다.   
> 백엔드에서 디버깅으로 BreakPoint를 걸면서 확인해 보니   
> {"account":"test3","password":"0000"}] ==> 리액트   
> [account=test3&password=0000] ==> 백엔드   
> 이처럼 각각 받는 값이 달라서 일어나는 문제인 것을 확인했다.   
> 그래서 리액트에서도 params.toString() 을 통해서 백엔드처럼 리퀘스트를 보내도록 하여 이슈를 해결했다.

 * __문제상황__ : 프론트엔드에서 로그인을 해도 백엔드에 닿지 않는 현상이 발생하여 로그인이 불가하게 됨.
   
  * __의도했던 기능__ : 프론트엔드와 백엔드가 연결되어 로그인이 가능해야 함.
 
  * __트러블 원인__   
    프론트엔드에서 로그인 버튼을 눌러도 백엔드에서 **account is null.** 이라는 ErrorLog가 나옴.
   
  * __트러블 해소과정 1__
    *localhost:8080* 으로 이동하여 로그인을 해보니 잘 되는것을 확인함.

  * __트러블 해소과정 2__
    백엔드에서 디버깅으로 확인해 보니
    > {"account":"test3","password":"0000"}] ==> 리액트   
    > [account=test3&password=0000] ==> 백엔드
    이처럼 각각 송신값과 수신값이 달라서 일어나는 문제인 것을 확인함.

  * __해결방법__
    프론트엔드 코드에서 params.toString()을 통해서 백엔드와 같은 형식으로 Request를 보내도록 하여 이슈를 해결함.


**로그인 RememberMe 이슈**
> 프론트에서 로그인시 사용자를 기억하지 못해서 백엔드와 통신이 불가능한 이슈가 발생했다.   
> 이번에도 8080포트로 가서 로그인을 해보니 RememberMe 라는 버튼이 있는 것을 확인했다.
> RememberMe 버튼을 클릭하고서 로그인하니 백엔드에서    
> [account=BSJ&password=3919&remember=on] 이처럼 뒤에 remember가 붙는 것을 확인했다.   
> 그래서 프론트에서도 똑같이 파라미터를 추가해주고 다른 백엔드와 통신하는 곳에는   
> withCredentials: true 를 추가해서 RememberMe가 유효하도록 하였다.

* __문제상황__ : 로그인시 사용자를 기억하지 못해서 백엔드와 통신이 불가능한 이슈가 발생함.
   
  * __의도했던 기능__ : 쿠키를 통해서 사용자를 기억하고 정상적인 이용이 가능해야 함.
 
  * __트러블 원인__   
    프론트엔드에서 로그인시 쿠키가 생성되지 않아 사용자를 기억할 수 없는 현상이 일어남.
   
  * __트러블 해소과정 1__
    *localhost:8080* 으로 이동하여 로그인 화면을 보니 *remember me* 라는 버튼이 있는 것을 확인함.

  * __트러블 해소과정 2__
     *remember me* 버튼 클릭 후 로그인시
    > [account=BSJ&password=3919&remember=on]
    위와 같이 뒷부분이 추가되고 쿠키가 생성되는 것을 확인함.

  * __해결방법__
    프론트엔드에서도 똑같이 파라미터를 추가하였음.
    로그인 외의 백엔드와 통신하는 부분은 *withCredentials: true* 를 추가해서 RememberMe를 유효하도록 함.
    


**포스트 Request 이슈**
> 백엔드에서는 Post 생성 리퀘스트를 받을 때에 사진파일 때문에 Multipart-form 으로 받게 했다.   
> 그래서 Postman으로 테스트를 할 때 헤더에 Multipart-form 이라고 명시를 하고 했더니   
> application-JSON으로 받아야 할 다른 리퀘스트들도 form 형식으로 전달되어 리퀘스트를 받아내지 못하는 이슈가 생겼다.   
> 여러 방법을 알아보다가 포스트맨에서 리퀘스트 부분만 Application-JSON으로 바꾸는 방법을 알아내서 실행했더니 제대로 실행이 되었다.

* __문제상황__ : 백엔드의 createPost 함수에서 리퀘스트를 받아내지 못함.
   
  * __의도했던 기능__ : createPost 함수에서 사진만 form 형식으로 받아내야 함.
 
  * __트러블 원인__   
    application-JSON 형식으로 받아야 하는 리퀘스트들이 사진과 함께 form 형식으로 받고 있는 것을 확인함.
   
  * __트러블 해소과정 1__
    Postman을 사용하여 파라미터 설정을 application-JSON으로 바꿔봤지만 사진이 form형식으로 가지 않아서 백엔드에서 리퀘스트를 받아내지 못했음.

  * __트러블 해소과정 2__
    Postman에서 파라미터를 각각 다른 형식으로 보낼 수 있는 방법을 알아 낸 후 테스트를 실행함.
    테스트 결과는 통과함.

  * __해결방법__
    백엔드 부분의 Request 타입을 *MediaType.MULTIPART_FORM_DATA_VALUE* 로 변경한 후
    
    ```
    ...
    formData.append(
        "postRequest",
        new Blob([JSON.stringify(updatedPostRequest)], {
          type: "application/json",
        })
      );

      try {
        const response = await axios.post(
          "http://localhost:8080/post/create",
          formData,
          { withCredentials: true }
        );
    ...
    ```
    프론트엔드 부분을 위 코드처럼 Blob을 추가하고 데이터 타입을 application-JSON으로 명시하여 해결했음.

**포스트 Request 이슈2**
> 포스트에서는 사진이 없는 파일도 생성이 가능하도록 만들었다.   
> 그랬더니 파일 리퀘스트가 존재하지 않아서 백엔드에서 받아내지 못하는 이슈가 발생했다.   
> 로그를 살펴보니 FileList 가 null 이라서 받지 않았다는 것을 확인했다.   
> 그래서 프론트에서는 FileList 가 null이면 비어있는 Blob을 보내도록 하였고   
> 백엔드에서는 if문으로 비어있는 blob을 받으면 서비스를 하지 않도록 하였다.

* __문제상황__ : 사진이 없는 스토리를 작성시 오류가 나는 이슈.
   
  * __의도했던 기능__ : 사진이 없는 스토리도 작성이 가능해야함.
 
  * __트러블 원인__   
    백엔드에서 무조건 fileList라는 Request를 받아야 하는데 사진이 존재하지 않아 리퀘스트에 fileList라는 formData가 존재하지 않음.
   
  * __트러블 해소과정 1__
    로그를 살펴보니 fileList가 null 이어서 리퀘스트를 받지 못한것을 확인함.

  * __해결방법__
    프론트엔드에서는 fileList가 null 이면 비어있는 Blob을 보내도록 하였고
    백엔드에서는 조건문을 사용하여 비어있는 Blob을 받으면 이미지 업로드 서비스를 실행하지 않도록 하였음.


- - -

## 5. 프로젝트 후기

일단 확실히 예전보다 집중력이 엄청나게 상승했다.   
백엔드는 웬만한건 다 할 수 있었지만 시큐리티는 회사에서도 하다가 포기했었는데   
이제 시큐리티도 어느정도 이해했다.   
파일 업로드 부분도 잘 몰랐는데 이제는 완벽하게 알겠다.   
구글링 능력도 예전에 비해 상승했다.

백엔드는 예전부터 해오던 것들이라 코드가 깔끔하게 나왔는데   
프론트는 너무 스파게티로 짜여졌다...   
함수명도 들쑥날쑥한 함수명이 많고  useEffect도 이상하게 쓰인 것 같은 부분이 많다.

네이버지도 API가 정말 고통스러웠지만 어떻게든 해냈다.   
물론 이상하게 하긴 했지만 내 선에서는 최선이었다...   
&lt;NaverMap&gt; 이 항상 능사는 아니다. <div id="map" 이 정답일 때도 있다.

AWS는 진짜로 잘못하면 돈이 왕창 빠져나간다. 앞으로 개인 프로젝트 할때는 웬만해서는 안 쓸 것 같다...   
AWS가 이 프로젝트 중에서 제일 어려웠던 부분인것 같다.   
아무래도 아예 처음보는 부분이라 그런 것 같다.   
리눅스 문법은 정말 중요했다. 종찬띠가 지나가면서 말하던 리눅스를 안 쓸 것 같지만 나중에 쓰게 된다는 말이 절실히 생각났다...

마지막으로 앞으로는 주석달기를 생활화하고 코드를 가시성 좋게 짜는 버릇을 들여야겠다.   
지금 보니까 내가 썼는데도 잘 모르겠다...
